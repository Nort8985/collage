<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Участники конкурсов</title>
    <link rel="stylesheet" href="all.css">
</head>

<body>
    <div class="container">
        <h1>Участники конкурсов</h1>
        <div id="contestList"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJpwKn9VaRLvKFk2bQiy62a58m_MNrLbM",
            authDomain: "collage-865e9.firebaseapp.com",
            databaseURL: "https://collage-865e9-default-rtdb.firebaseio.com",
            projectId: "collage-865e9",
            storageBucket: "collage-865e9.appspot.com",
            messagingSenderId: "352289967594",
            appId: "1:352289967594:web:0d697b16dab912c8c13693",
            measurementId: "G-L4JC4BLB9L"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const contestList = document.getElementById("contestList");

        onValue(ref(database, "contests"), (snapshot) => {
            contestList.innerHTML = "";
            snapshot.forEach(contestSnapshot => {
                const contestName = contestSnapshot.key;
                const div = document.createElement("div");
                div.innerHTML = `<h2>${contestName}</h2>`;
                contestSnapshot.forEach(participantSnapshot => {
                    const participantKey = participantSnapshot.key; // Получаем уникальный ключ участника
                    const participant = participantSnapshot.val();
                    div.innerHTML += `
                        <p>
                            ${participant.name} (${participant.group}) 
                            <button class="delete-btn" data-contest="${contestName}" data-key="${participantKey}">
                                Удалить
                            </button>
                        </p>
                    `;
                });
                contestList.appendChild(div);
            });
        });

        document.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const contest = event.target.dataset.contest;
                const participantKey = event.target.dataset.key;

                // Удаление из Firebase
                const participantRef = ref(database, `contests/${contest}/${participantKey}`);
                remove(participantRef)
                    .then(() => {
                        console.log(`Участник из ${contest} удален`);
                    })
                    .catch((error) => {
                        console.error("Ошибка удаления:", error);
                    });
            }
        });
    </script>
</body>

</html>